<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>后台添加商品</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="/static/js/layuiadmin/layui/css/layui.css" media="all">
    <link href="/static/css/wangEditor.css" rel="stylesheet">
    <style>
        .toolbar {
            border: 1px solid #ccc;/*设置下拉棒*/
        }
        .w-e-text-container{
            height: 840px !important;/*!important是重点，因为原div是行内样式设置的高度300px*/
        }
    </style>
</head>
<body>
<div style="padding: 20px">

    <div style="display: flex">
        <div style="margin-right: 50px">
            <form class="layui-form" style="text-align: center" lay-filter="test">
                <div class="layui-form-item" >
                    <label class="layui-form-label">商品父类</label>
                    <div class="layui-input-block" style="width: 280px;margin-top: 17px">
                        <select name="cid" lay-filter="big">
                            <option value="0">选择类型</option>
                            <option th:value="${t.cid}" th:each="t:${types}" th:text="${t.typeName}"></option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">商品子类</label>
                    <div class="layui-input-block" style="width: 280px">
                        <select name="parentTypeId" id="parentTypeId"><!--id="parentTypeId"-->

                        </select>
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom: 10px;margin-top: 10px">
                    <label class="layui-form-label">商品名称</label>
                    <div class="layui-input-inline">
                        <input type="text" name="pname" lay-verify="required" placeholder="请输入商品名称" autocomplete="off"
                               class="layui-input"
                               style="width: 280px" required>
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom: 10px;margin-top: 10px">
                    <label class="layui-form-label">市场价格</label>
                    <div class="layui-input-inline">
                        <input type="text" name="marketPrice" lay-verify="required|number" placeholder="请输入商品价格"
                               autocomplete="off"
                               class="layui-input"
                               style="width: 280px" required>
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom: 10px;margin-top: 10px">
                    <label class="layui-form-label">商城价格</label>
                    <div class="layui-input-inline">
                        <input type="text" name="shopPrice" lay-verify="required" placeholder="请输入商城价格"
                               autocomplete="off"
                               class="layui-input"
                               style="width: 280px" required>
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom: 10px;margin-top: 10px">
                    <label class="layui-form-label">商品版本</label>
                    <div class="layui-input-inline">
                        <input type="text" name="pVersion" lay-verify="required" placeholder="请输入商品版本"
                               class="layui-input"
                               style="width: 280px" required>
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom: 10px;margin-top: 10px">
                    <label class="layui-form-label">商品颜色</label>
                    <div class="layui-input-inline">
                        <input type="text" name="pColor" lay-verify="required" placeholder="请输入商品颜色"
                               class="layui-input"
                               style="width: 280px" required>
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom: 10px;margin-top: 10px">
                    <label class="layui-form-label">商品描述</label>
                    <div class="layui-input-inline">
                        <input type="text" name="pdesc" lay-verify="pdesc" placeholder="请输入商品描述" autocomplete="off"
                               class="layui-input"
                               style="width: 280px" required>
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom: 10px;margin-top: 10px">
                    <label class="layui-form-label">商品消息</label>
                    <div class="layui-input-inline">
                        <input type="text" name="pMsg" lay-verify="pMsg" placeholder="请输入商品消息"
                               class="layui-input"
                               style="width: 280px">
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom: 10px;margin-top: 10px">
                    <label class="layui-form-label">商品标语</label>
                    <div class="layui-input-inline">
                        <input type="text" name="pSolgan" lay-verify="pSolgan" placeholder="请输入商品标语"
                               class="layui-input"
                               style="width: 280px">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">所属分类</label>
                    <div class="layui-input-block" style="width: 280px">
                        <select name="pBelong" lay-verify="required">
                            <option value=""></option>
                            <option value="0">热销商品</option>
                            <option value="1">精品推荐</option>
                            <option value="2">手机</option>
                            <option value="3">笔记本</option>
                            <option value="4">平板</option>
                            <option value="5">智能穿戴</option>
                            <option value="6">智能家居</option>
                            <option value="7">热销配件</option>
                            <option value="8">生态精品</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom: 10px;margin-top: 10px">
                    <label class="layui-form-label">商品库存</label>
                    <div class="layui-input-inline">
                        <input type="text" name="pstock" lay-verify="number" placeholder="请输入商品库存"
                               class="layui-input"
                               style="width: 280px" required>
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom: 10px;margin-top: 10px">
                    <label class="layui-form-label">商品排序</label>
                    <div class="layui-input-inline">
                        <input type="text" name="pSort" lay-verify="number" placeholder="请输入商品排序"
                               class="layui-input"
                               style="width: 280px">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">是否上架</label>
                    <div class="layui-input-block" style="width: 10px">
                        <input type="checkbox" name="pflag" lay-skin="switch" lay-text="ON|OFF">
                    </div>
                </div>

                <div class="layui-form-item" style="margin-bottom: 10px;margin-top: 10px">
                    <label class="layui-form-label">商品图片</label>
                    <div class="layui-input-inline">
                        <div class="layui-upload-drag" id="previewImg">
                            <i class="layui-icon"></i>
                            <p>点击上传，或将文件拖拽到此处</p>
                            <img src="" alt="" id="pImg"
                                 style="border: 1px solid darkgrey;border-radius: 5px;width: 100%;height: 100%">
                        </div>
                        <input type="file" name="pim" id="pim" style="display: none" accept="image/*">
                    </div>
                </div>
                <input type="hidden" name="pdetails" id="pdetails">
                <div style="width: 410px">
                    <button type="button" class="layui-btn layui-btn-normal" style="width: 180px" lay-submit lay-filter="ordersForm">确认提交
                    </button>
                </div>
            </form>
        </div>
        <div style="flex-grow: 1">
            <h4 style="text-align: center">商品详情</h4>
            <div id="wangEdit" name="wangEdit" class="toolbar" style="width: 100%"></div>
        </div>
    </div>
</div>
<script src="/static/js/layui/layui.js"></script>
<script src="/static/js/jquery-3.4.1.min.js"></script>
<script src="/static/js/wangEditor.js"></script>
</body>
<script>
    layui.use(['form'], function () {
        var form = layui.form;
        /*预览图片*/
        $('#previewImg').click(function () {
            layer.msg("选择图片")
            $('#pim').click();
            $('#pim').change(function () { //点击改变图片的src 从而实现预览图片的功能
                layer.msg("改变了时候可以拿到img文件")
                let file = this.files[0];
                imgPreview(file, $('#pImg')[0]);
                layer.msg("改变了")
            });

        })

        form.on('select(big)', function (data) {
            console.log(data); //得到select原始DOM对象
            console.log(data.elem); //得到select原始DOM对象
            console.log(data.value); //得到被选中的值
            console.log(data.othis); //得到美化后的DOM对象
            var cid = data.value;
            $.ajax({
                url: "/productType/cascade/id=" + cid,
                // data:cid,
                dateType: 'json',
                type: 'post',
                success: function (res) {
                    /* if(res.success){
                         form.render('select','aihao');//需要渲染一下
                         layer.msg("返回成功")
                     }*/

                    console.log(res);
                    //$("#parentTypeId").find("option").remove(); 2个都行 每次选择都会先清空select标签
                    $('#parentTypeId').empty();
                    form.render('select', 'test');//需要渲染一下
                    $.each(res, function (index, item) {
                        //wang parentTypeId li加
                        var option = '<option value="' + item.parentTypeId + '">' + item.typeName + '</option>'
                        $('#parentTypeId').append(option)
                        form.render('select', 'test');//需要渲染一下
                    })
                }
            })
        });

        $(function () {
            //富文本
            var E = window.wangEditor;
            var editor = new E('#wangEdit');
            //使用base64保存图片
            editor.customConfig.uploadImgShowBase64 = true;
            //使用路径传参
            editor.customConfig.uploadImgParamsWithUrl = true;
            editor.create();

            form.on('submit(ordersForm)', function (data) {
                //获得富文本输入框的内容
                let text = editor.txt.html();
                console.log(text);
                //赋值
                $('#pdetails').val(text);
                console.log(data.elem); //得到checkbox原始DOM对象
                console.log(data.elem.checked); //是否被选中，true或者false
                console.log(data.value); //复选框value值，也可以通过data.elem.value得到
                console.log(data.othis); //得到美化后的DOM对象
                console.log(data.field); //得到当前表单全部字段
                console.log(data.form); //得到当前表单全部字段
                let formData = new FormData(data.form);
                $.ajax({
                    url: "/product/add",
                    contentType: false,//传递的东西有很多种数据格式的时候 写false
                    data: formData,
                    processData: false,
                    success: function (data) {
                        if (data.success) {
                            layer.msg("添加成功")
                        }else {
                            layer.msg("添加失败")
                        }
                    },
                    type: 'post',
                })
            })

        })


    })

    //图片上传预览功能，file：指的是文件，img指的是js dom对象q("#id")[0]
    function imgPreview(file, imgDom) {
        //判断是否支持FileReader
        if (window.FileReader) {
            var reader = new FileReader();
        } else {
            layer.msg("您的设备不支持图片预览功能，如需使用该功能请升级您的设别");
        }
        var imageType = /^image\//;
        //是否是图片
        if (!imageType.test(file.type)) {
            layer.msg("请选择图片！")
            return;
        }
        //读取完成
        reader.onload = function (e) {
            //获得图片dom
            //图片路径设置为读取的图片
            imgDom.src = e.target.result;
        };
        reader.readAsDataURL(file)
    }


</script>
</html>